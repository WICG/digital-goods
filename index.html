<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Digital Goods API</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version 2e3c4c68b, updated Fri Jan 14 14:49:00 2022 -0800" name="generator">
  <link href="https://wicg.github.io/digital-goods/" rel="canonical">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Digital Goods API</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2022-02-24">24 February 2022</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/digital-goods/">https://wicg.github.io/digital-goods/</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/WICG/digital-goods/issues/">GitHub</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:glenrob@chromium.org">Glen Robertson</a> (<a class="p-org org" href="https://www.google.com/">Google</a>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:mgiuca@chromium.org">Matt Giuca</a> (<a class="p-org org" href="https://www.google.com/">Google</a>)
     <dt>Participate:
     <dd><a href="https://github.com/WICG/digital-goods">GitHub WICG/digital-goods</a> (<a href="https://github.com/WICG/digital-goods/issues/new">new issue</a>, <a href="https://github.com/WICG/digital-goods/issues?state=open">open issues</a>)
     <dt>Tests:
     <dd><a href="https://github.com/w3c/web-platform-tests/tree/master/digital-goods">web-platform-tests digital-goods/</a> (<a href="https://github.com/w3c/web-platform-tests/labels/digital-goods">ongoing work</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2022 the Contributors to the Digital Goods API Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>The Digital Goods API allows web applications to get information about their digital products and their user’s purchases managed by a digital store. The user agent abstracts connections to the store and the <a href="https://www.w3.org/TR/payment-request/">Payment Request API</a> is used to make purchases.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#usage-examples"><span class="secno">1</span> <span class="content">Usage Examples</span></a>
     <ol class="toc">
      <li><a href="#getting-a-service-instance"><span class="secno">1.1</span> <span class="content">Getting a service instance</span></a>
      <li><a href="#querying-item-details"><span class="secno">1.2</span> <span class="content">Querying item details</span></a>
      <li><a href="#purchase-using-payment-request-api"><span class="secno">1.3</span> <span class="content">Purchase using Payment Request API</span></a>
      <li><a href="#checking-existing-purchases"><span class="secno">1.4</span> <span class="content">Checking existing purchases</span></a>
      <li><a href="#consuming-a-purchase"><span class="secno">1.5</span> <span class="content">Consuming a purchase</span></a>
      <li><a href="#use-with-subdomain-iframes"><span class="secno">1.6</span> <span class="content">Use with subdomain iframes</span></a>
     </ol>
    <li>
     <a href="#api-definition"><span class="secno">2</span> <span class="content">API definition</span></a>
     <ol class="toc">
      <li>
       <a href="#extensions-to-the-window-interface"><span class="secno">2.1</span> <span class="content">Extensions to the Window interface</span></a>
       <ol class="toc">
        <li><a href="#getdigitalgoodsservice-method"><span class="secno">2.1.1</span> <span class="content">getDigitalGoodsService() method</span></a>
        <li><a href="#sec-can-make-digital-goods-service-algorithm"><span class="secno">2.1.2</span> <span class="content">Can make digital goods service algorithm</span></a>
       </ol>
      <li>
       <a href="#digitalgoodsservice-interface"><span class="secno">2.2</span> <span class="content">DigitalGoodsService interface</span></a>
       <ol class="toc">
        <li><a href="#getDetails-method"><span class="secno">2.2.1</span> <span class="content">getDetails() method</span></a>
        <li><a href="#listPurchases-method"><span class="secno">2.2.2</span> <span class="content">listPurchases() method</span></a>
        <li><a href="#consume-method"><span class="secno">2.2.3</span> <span class="content">consume() method</span></a>
       </ol>
      <li><a href="#itemDetails-dictionary"><span class="secno">2.3</span> <span class="content">ItemDetails dictionary</span></a>
      <li><a href="#purchaseDetails-dictionary"><span class="secno">2.4</span> <span class="content">PurchaseDetails dictionary</span></a>
     </ol>
    <li><a href="#permissions-policy-integration"><span class="secno">3</span> <span class="content">Permissions Policy integration</span></a>
    <li><a href="#additional-definitions"><span class="secno">4</span> <span class="content">Additional Definitions</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="usage-examples"><span class="secno">1. </span><span class="content">Usage Examples</span><a class="self-link" href="#usage-examples"></a></h2>
   <p class="note" role="note"><span>Note:</span> This section is non-normative.</p>
   <h3 class="heading settled" data-level="1.1" id="getting-a-service-instance"><span class="secno">1.1. </span><span class="content">Getting a service instance</span><a class="self-link" href="#getting-a-service-instance"></a></h3>
   <div class="example" id="Getting a service instance">
    <a class="self-link" href="#Getting%20a%20service%20instance"></a> Usage of the API begins with a call to <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice" id="ref-for-dom-window-getdigitalgoodsservice">window.getDigitalGoodsService()</a></code>, which
  might only be available in certain contexts (eg. HTTPS, app, browser, OS). If
  available, the method can be called with a service provider URL. The method
  returns a promise that is rejected if the given service provider is not
  available. 
<pre class="highlight"><c- k>if</c-> <c- p>(</c->window<c- p>.</c->getDigitalGoodsService <c- o>===</c-> <c- kc>undefined</c-><c- p>)</c-> <c- p>{</c->
  <c- c1>// Digital Goods API is not supported in this context.</c->
  <c- k>return</c-><c- p>;</c->
<c- p>}</c->
<c- k>try</c-> <c- p>{</c->
  <c- a>const</c-> digitalGoodsService <c- o>=</c-> <c- k>await</c->
      window<c- p>.</c->getDigitalGoodsService<c- p>(</c-><c- u>"https://example.com/billing"</c-><c- p>);</c->
  <c- c1>// Use the service here.</c->
  <c- p>...</c->
<c- p>}</c-> <c- k>catch</c-> <c- p>(</c->error<c- p>)</c-> <c- p>{</c->
  <c- c1>// Our preferred service provider is not available.</c->
  <c- c1>// Use a normal web-based payment flow.</c->
  console<c- p>.</c->error<c- p>(</c-><c- u>"Failed to get service:"</c-><c- p>,</c-> error<c- p>.</c->message<c- p>);</c->
  <c- k>return</c-><c- p>;</c->
<c- p>}</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="1.2" id="querying-item-details"><span class="secno">1.2. </span><span class="content">Querying item details</span><a class="self-link" href="#querying-item-details"></a></h3>
   <div class="example" id="Querying item details">
    <a class="self-link" href="#Querying%20item%20details"></a> 
<pre class="highlight"><c- a>const</c-> details <c- o>=</c-> <c- k>await</c-> digitalGoodsService
    <c- p>.</c->getDetails<c- p>([</c-><c- t>'shiny_sword'</c-><c- p>,</c-> <c- t>'gem'</c-><c- p>,</c-> <c- t>'monthly_subscription'</c-><c- p>]);</c->
<c- k>for</c-> <c- p>(</c->item <c- k>of</c-> details<c- p>)</c-> <c- p>{</c->
  <c- a>const</c-> priceStr <c- o>=</c-> <c- ow>new</c-> Intl<c- p>.</c->NumberFormat<c- p>(</c->
      locale<c- p>,</c->
      <c- p>{</c->style<c- o>:</c-> <c- t>'currency'</c-><c- p>,</c-> currency<c- o>:</c-> item<c- p>.</c->price<c- p>.</c->currency<c- p>}</c->
    <c- p>).</c->format<c- p>(</c->item<c- p>.</c->price<c- p>.</c->value<c- p>);</c->
  AddShopMenuItem<c- p>(</c->item<c- p>.</c->itemId<c- p>,</c-> item<c- p>.</c->title<c- p>,</c-> priceStr<c- p>,</c-> item<c- p>.</c->description<c- p>);</c->
<c- p>}</c->
</pre>
    <p>The <code class="idl"><a data-link-type="idl" href="#dom-digitalgoodsservice-getdetails" id="ref-for-dom-digitalgoodsservice-getdetails">getDetails()</a></code> method returns server-side details
  about a given set of items, intended to be displayed to the user in a menu, so
  that they can see the available purchase options and prices without having to
  go through a purchase flow.</p>
    <p>The returned <code class="idl"><a data-link-type="idl" href="#dictdef-itemdetails" id="ref-for-dictdef-itemdetails">ItemDetails</a></code> sequence can be in any order and might not
  include an item if it doesn’t exist on the server (i.e. there is not a 1:1
  correspondence between the input list and output).</p>
    <p>The item ID is a string representing the primary key of the items, configured
  in the store server. There is no function to get a list of item IDs; those
  have to be hard-coded in the client code or fetched from the developer’s own
  server.</p>
    <p>The item’s price is a <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount">PaymentCurrencyAmount</a></code> containing the current price
  of the item in the user’s current region and currency. It is designed to be
  formatted for the user’s current locale using <a href="https://tc39.es/ecma402/#sec-intl.numberformat">Intl.NumberFormat</a>, as shown above.</p>
    <p>For more information on the fields in the <code class="idl"><a data-link-type="idl" href="#dictdef-itemdetails" id="ref-for-dictdef-itemdetails①">ItemDetails</a></code> object, refer to the
  [ItemDetails dictionary] section below.</p>
   </div>
   <h3 class="heading settled" data-level="1.3" id="purchase-using-payment-request-api"><span class="secno">1.3. </span><span class="content">Purchase using Payment Request API</span><a class="self-link" href="#purchase-using-payment-request-api"></a></h3>
   <div class="example" id="Purchase using Payment Request API">
    <a class="self-link" href="#Purchase%20using%20Payment%20Request%20API"></a> 
<pre class="highlight"><c- a>const</c-> details <c- o>=</c-> <c- k>await</c-> digitalGoodsService<c- p>.</c->getDetails<c- p>([</c-><c- t>'monthly_subscription'</c-><c- p>]);</c->
<c- a>const</c-> item <c- o>=</c-> details<c- p>[</c-><c- mf>0</c-><c- p>];</c->
<c- ow>new</c-> PaymentRequest<c- p>(</c->
  <c- p>[{</c->supportedMethods<c- o>:</c-> <c- t>'https://example.com/billing'</c-><c- p>,</c->
    data<c- o>:</c-> <c- p>{</c->itemId<c- o>:</c-> item<c- p>.</c->itemId<c- p>}}]);</c->
</pre>
    <p>The purchase flow itself uses the <a data-link-type="biblio" href="#biblio-payment-request">Payment Request API</a>. We
  don’t show the
  full payment request code here, but note that the item ID for any items the
  user chooses to purchase can be sent in the <code>data</code> field of a <code>methodData</code> entry
  for the given payment method, in a manner specific to the store.</p>
   </div>
   <h3 class="heading settled" data-level="1.4" id="checking-existing-purchases"><span class="secno">1.4. </span><span class="content">Checking existing purchases</span><a class="self-link" href="#checking-existing-purchases"></a></h3>
   <div class="example" id="Checking existing purchases">
    <a class="self-link" href="#Checking%20existing%20purchases"></a> 
<pre class="highlight">purchases <c- o>=</c-> <c- k>await</c-> digitalGoodsService<c- p>.</c->listPurchases<c- p>();</c->
<c- k>for</c-> <c- p>(</c->p <c- k>of</c-> purchases<c- p>)</c-> <c- p>{</c->
  VerifyOnBackendAndGrantEntitlement<c- p>(</c->p<c- p>.</c->itemId<c- p>,</c-> p<c- p>.</c->purchaseToken<c- p>);</c->
<c- p>}</c->
</pre>
    <p>The <code class="idl"><a data-link-type="idl" href="#dom-digitalgoodsservice-listpurchases" id="ref-for-dom-digitalgoodsservice-listpurchases">listPurchases()</a></code> method allows a client to get a
  list of items that are
  currently owned or purchased by the user. This might be necessary to check for
  entitlements (e.g. whether a subscription, promotional code, or permanent
  upgrade is active) or to recover from network interruptions during a purchase
  (e.g. item is purchased but not yet confirmed with a backend). The method
  returns item IDs and purchase tokens, which would typically be verified using
  a direct developer-to-provider API before granting entitlements.</p>
   </div>
   <h3 class="heading settled" data-level="1.5" id="consuming-a-purchase"><span class="secno">1.5. </span><span class="content">Consuming a purchase</span><a class="self-link" href="#consuming-a-purchase"></a></h3>
   <div class="example" id="Consuming a purchase">
    <a class="self-link" href="#Consuming%20a%20purchase"></a> 
<pre class="highlight">digitalGoodsService<c- p>.</c->consume<c- p>(</c->purchaseToken<c- p>);</c->
</pre>
    <p>Purchases that are designed to be purchased multiple times usually need to be
  marked as "consumed" before they can be purchased again by the user. An
  example of a consumable purchase is an in-game powerup that makes the player
  stronger for a short period of time. This can be done with the <code class="idl"><a data-link-type="idl" href="#dom-digitalgoodsservice-consume" id="ref-for-dom-digitalgoodsservice-consume">consume()</a></code> method.</p>
    <p>It is preferable to use a direct developer-to-provider API to consume
  purchases, if one is available, in order to more verifiably ensure that a
  purchase was used up.</p>
   </div>
   <h3 class="heading settled" data-level="1.6" id="use-with-subdomain-iframes"><span class="secno">1.6. </span><span class="content">Use with subdomain iframes</span><a class="self-link" href="#use-with-subdomain-iframes"></a></h3>
   <div class="example" id="Use with subdomain iframes">
    <a class="self-link" href="#Use%20with%20subdomain%20iframes"></a> 
<pre class="highlight"><c- o>&lt;</c->iframe
  src<c- o>=</c-><c- u>"https://sub.origin.example"</c->
  allow<c- o>=</c-><c- u>"payment"</c-><c- o>></c->
<c- o>&lt;</c->/iframe>
</pre>
    <p>To indicate that a subdomain iframe is allowed to invoke the Digital Goods
  API, the <code>allow</code> attribute along with the <code>"payment"</code> keyword can be specified on the iframe element. Cross-origin iframes cannot
  invoke the Digital Goods API. The <a data-link-type="biblio" href="#biblio-permissions-policy">Permissions Policy</a> specification provides further
  details and examples.</p>
   </div>
   <h2 class="heading settled" data-level="2" id="api-definition"><span class="secno">2. </span><span class="content">API definition</span><a class="self-link" href="#api-definition"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="extensions-to-the-window-interface"><span class="secno">2.1. </span><span class="content">Extensions to the Window interface</span><a class="self-link" href="#extensions-to-the-window-interface"></a></h3>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window"><c- g>Window</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#digitalgoodsservice" id="ref-for-digitalgoodsservice"><c- n>DigitalGoodsService</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-window-getdigitalgoodsservice" id="ref-for-dom-window-getdigitalgoodsservice①"><c- g>getDigitalGoodsService</c-></a>(
      <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="Window/getDigitalGoodsService(serviceProvider)" data-dfn-type="argument" data-export id="dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider"><code><c- g>serviceProvider</c-></code></dfn>);
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window①">Window</a></code> object MAY expose a <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice" id="ref-for-dom-window-getdigitalgoodsservice②">getDigitalGoodsService()</a></code> method.
User agents that do not support Digital Goods SHOULD NOT expose <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice" id="ref-for-dom-window-getdigitalgoodsservice③">getDigitalGoodsService()</a></code> on the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window②">Window</a></code> interface.</p>
   <p class="note" role="note"><span>Note:</span> The above statement is designed to permit feature detection. If <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice" id="ref-for-dom-window-getdigitalgoodsservice④">getDigitalGoodsService()</a></code> is present, there is a reasonable
expectation that it will work with at least one service provider.</p>
   <h4 class="heading settled" data-level="2.1.1" id="getdigitalgoodsservice-method"><span class="secno">2.1.1. </span><span class="content">getDigitalGoodsService() method</span><a class="self-link" href="#getdigitalgoodsservice-method"></a></h4>
   <p class="note" role="note"><span>Note:</span> The <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice" id="ref-for-dom-window-getdigitalgoodsservice⑤">getDigitalGoodsService()</a></code> method is called to determine
whether the given <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider" id="ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider">serviceProvider</a></code> is supported
in the current context. The method returns a Promise that will be resolved with
a <code class="idl"><a data-link-type="idl" href="#digitalgoodsservice" id="ref-for-digitalgoodsservice①">DigitalGoodsService</a></code> object if the serviceProvider is supported, or
rejected with an exception if the serviceProvider is unsupported or any error
occurs. The <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider" id="ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider①">serviceProvider</a></code> is usually a <a data-link-type="dfn" href="https://www.w3.org/TR/payment-method-id/#dfn-url-based-payment-method-identifier" id="ref-for-dfn-url-based-payment-method-identifier">url-based payment method identifier</a>.</p>
   <div class="algorithm" data-algorithm="getDigitalGoodsService(serviceProvider)" data-algorithm-for="Window">
     When the <dfn class="dfn-paneled idl-code" data-dfn-for="Window" data-dfn-type="method" data-export id="dom-window-getdigitalgoodsservice"><code>getDigitalGoodsService(<var>serviceProvider</var>)</code></dfn> method is called, run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>document</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object" id="ref-for-current-settings-object">current settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-document" id="ref-for-responsible-document">responsible document</a>.</p>
     <li data-md>
      <p>If <var>document</var> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#fully-active" id="ref-for-fully-active">fully active</a>, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with">a promise rejected with</a> an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">"InvalidStateError"</a></code> <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin">same origin</a> with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin">top-level origin</a> return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with①">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror">"NotAllowedError"</a></code> <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>document</var> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use" id="ref-for-allowed-to-use">allowed to use</a> the "<a data-link-type="dfn" href="#payment" id="ref-for-payment">payment</a>" permission return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with②">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror①">"NotAllowedError"</a></code> <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>serviceProvider</var> is undefined or null or the empty string return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with③">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>result</var> be the result of performing the <a data-link-type="dfn" href="#can-make-digital-goods-service-algorithm" id="ref-for-can-make-digital-goods-service-algorithm">can make digital goods service algorithm</a> given <var>serviceProvider</var> and <var>document</var>.</p>
     <li data-md>
      <p>If <var>result</var> is false return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with④">a promise rejected with</a> an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#operationerror" id="ref-for-operationerror">OperationError</a></code>.</p>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with">a promise resolved with</a> a new <code class="idl"><a data-link-type="idl" href="#digitalgoodsservice" id="ref-for-digitalgoodsservice②">DigitalGoodsService</a></code>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="2.1.2" id="sec-can-make-digital-goods-service-algorithm"><span class="secno">2.1.2. </span><span class="content">Can make digital goods service algorithm</span><a class="self-link" href="#sec-can-make-digital-goods-service-algorithm"></a></h4>
   <div class="algorithm" data-algorithm="can make digital goods service algorithm">
     The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="can-make-digital-goods-service-algorithm">can make digital goods service algorithm</dfn> checks whether the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent">user agent</a> supports a given <var>serviceProvider</var> and <var>document</var> context. 
    <ol>
     <li data-md>
      <p>The <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①">user agent</a> MAY return true or return false based on the <var>serviceProvider</var> or <var>document</var> or external factors.</p>
    </ol>
    <p class="note" role="note"><span>Note:</span> This allows for user agents to support different service providers in
  different contexts.</p>
   </div>
   <h3 class="heading settled" data-level="2.2" id="digitalgoodsservice-interface"><span class="secno">2.2. </span><span class="content">DigitalGoodsService interface</span><a class="self-link" href="#digitalgoodsservice-interface"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext①"><c- g>SecureContext</c-></a>] <c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="digitalgoodsservice"><code><c- g>DigitalGoodsService</c-></code></dfn> {

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-itemdetails" id="ref-for-dictdef-itemdetails②"><c- n>ItemDetails</c-></a>>> <a class="idl-code" data-link-type="method" href="#dom-digitalgoodsservice-getdetails" id="ref-for-dom-digitalgoodsservice-getdetails①"><c- g>getDetails</c-></a>(<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence①"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a>> <dfn class="idl-code" data-dfn-for="DigitalGoodsService/getDetails(itemIds)" data-dfn-type="argument" data-export id="dom-digitalgoodsservice-getdetails-itemids-itemids"><code><c- g>itemIds</c-></code><a class="self-link" href="#dom-digitalgoodsservice-getdetails-itemids-itemids"></a></dfn>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise②"><c- b>Promise</c-></a>&lt;<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence②"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-purchasedetails" id="ref-for-dictdef-purchasedetails"><c- n>PurchaseDetails</c-></a>>> <a class="idl-code" data-link-type="method" href="#dom-digitalgoodsservice-listpurchases" id="ref-for-dom-digitalgoodsservice-listpurchases①"><c- g>listPurchases</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise③"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-digitalgoodsservice-consume" id="ref-for-dom-digitalgoodsservice-consume①"><c- g>consume</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="DigitalGoodsService/consume(purchaseToken)" data-dfn-type="argument" data-export id="dom-digitalgoodsservice-consume-purchasetoken-purchasetoken"><code><c- g>purchaseToken</c-></code><a class="self-link" href="#dom-digitalgoodsservice-consume-purchasetoken-purchasetoken"></a></dfn>);
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-itemdetails"><code><c- g>ItemDetails</c-></code></dfn> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="ItemDetails" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-itemdetails-itemid"><code><c- g>itemId</c-></code></dfn>;
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString④"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="ItemDetails" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-itemdetails-title"><code><c- g>title</c-></code></dfn>;
  <c- b>required</c-> <a data-link-type="idl-name" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount①"><c- n>PaymentCurrencyAmount</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="ItemDetails" data-dfn-type="dict-member" data-export data-type="PaymentCurrencyAmount " id="dom-itemdetails-price"><code><c- g>price</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑤"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="ItemDetails" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-itemdetails-description"><code><c- g>description</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑥"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="ItemDetails" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-itemdetails-subscriptionperiod"><code><c- g>subscriptionPeriod</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑦"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="ItemDetails" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-itemdetails-freetrialperiod"><code><c- g>freeTrialPeriod</c-></code></dfn>;
  <a data-link-type="idl-name" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount②"><c- n>PaymentCurrencyAmount</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="ItemDetails" data-dfn-type="dict-member" data-export data-type="PaymentCurrencyAmount " id="dom-itemdetails-introductoryprice"><code><c- g>introductoryPrice</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑧"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="ItemDetails" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-itemdetails-introductorypriceperiod"><code><c- g>introductoryPricePeriod</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-purchasedetails"><code><c- g>PurchaseDetails</c-></code></dfn> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑨"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PurchaseDetails" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-purchasedetails-itemid"><code><c- g>itemId</c-></code></dfn>;
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①⓪"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PurchaseDetails" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-purchasedetails-purchasetoken"><code><c- g>purchaseToken</c-></code></dfn>;
};
</pre>
   <h4 class="heading settled" data-level="2.2.1" id="getDetails-method"><span class="secno">2.2.1. </span><span class="content">getDetails() method</span><a class="self-link" href="#getDetails-method"></a></h4>
   <div class="algorithm" data-algorithm="getDetails(itemIds)" data-algorithm-for="DigitalGoodsService">
     When the <dfn class="dfn-paneled idl-code" data-dfn-for="DigitalGoodsService" data-dfn-type="method" data-export id="dom-digitalgoodsservice-getdetails"><code>getDetails(<var>itemIds</var>)</code></dfn> method is called, run the following steps: 
    <ol>
     <li data-md>
      <p>If <var>itemIds</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty">is empty</a>, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑤">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror①">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>result</var> be the result of requesting information about the given <var>itemIds</var> from the digital goods service.</p>
    </ol>
    <p class="note" role="note"><span>Note:</span> This allows for different digital goods service providers to be
    supported by provider-specific behavior in the user agent.</p>
    <ol>
     <li data-md>
      <p>If <var>result</var> is an error, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑥">a promise rejected with</a> an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#operationerror" id="ref-for-operationerror①">OperationError</a></code>.</p>
     <li data-md>
      <p>For each <var>itemDetails</var> in <var>result</var>:</p>
      <ol>
       <li data-md>
        <p><var>itemDetails</var>.itemId SHOULD NOT be the empty string.</p>
       <li data-md>
        <p><var>itemIds</var> SHOULD <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contain</a> <var>itemDetails</var>.itemId.</p>
       <li data-md>
        <p><var>itemDetails</var>.title SHOULD NOT be the empty string.</p>
       <li data-md>
        <p><var>itemDetails</var>.price MUST be a <a data-link-type="dfn" href="#canonical-paymentcurrencyamount" id="ref-for-canonical-paymentcurrencyamount">canonical PaymentCurrencyAmount</a>.</p>
       <li data-md>
        <p>If present, <var>itemDetails</var>.subscriptionPeriod MUST be be a <a data-link-type="dfn" href="#iso-8601" id="ref-for-iso-8601">iso-8601</a> duration.</p>
       <li data-md>
        <p>If present, <var>itemDetails</var>.freeTrialPeriod MUST be be a <a data-link-type="dfn" href="#iso-8601" id="ref-for-iso-8601①">iso-8601</a> duration.</p>
       <li data-md>
        <p>If present, <var>itemDetails</var>.introductoryPrice MUST be a <a data-link-type="dfn" href="#canonical-paymentcurrencyamount" id="ref-for-canonical-paymentcurrencyamount①">canonical PaymentCurrencyAmount</a>.</p>
       <li data-md>
        <p>If present, <var>itemDetails</var>.introductoryPricePeriod MUST be be a <a data-link-type="dfn" href="#iso-8601" id="ref-for-iso-8601②">iso-8601</a> duration.</p>
      </ol>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with①">a promise resolved with</a> <var>result</var>.</p>
    </ol>
    <p class="note" role="note"><span>Note:</span> There is no requirement that the ordering of items in <var>result</var> matches
    the ordering of items in <var>itemIds</var>. This is to allow for missing or invalid
    items to be skipped in the output list.</p>
   </div>
   <h4 class="heading settled" data-level="2.2.2" id="listPurchases-method"><span class="secno">2.2.2. </span><span class="content">listPurchases() method</span><a class="self-link" href="#listPurchases-method"></a></h4>
   <div class="algorithm" data-algorithm="listPurchases()" data-algorithm-for="DigitalGoodsService">
     When the <dfn class="dfn-paneled idl-code" data-dfn-for="DigitalGoodsService" data-dfn-type="method" data-export id="dom-digitalgoodsservice-listpurchases"><code>listPurchases()</code></dfn> method is
  called, run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>result</var> be the result of requesting information about the user’s purchases from the digital goods service.</p>
    </ol>
    <p class="note" role="note"><span>Note:</span> This allows for different digital goods service providers to be supported by provider-specific behavior in the user agent.</p>
    <ol>
     <li data-md>
      <p>If <var>result</var> is an error, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑦">a promise rejected with</a> an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#operationerror" id="ref-for-operationerror②">OperationError</a></code>.</p>
     <li data-md>
      <p>For each <var>itemDetails</var> in <var>result</var>:</p>
      <ol>
       <li data-md>
        <p><var>itemDetails</var>.itemId SHOULD NOT be the empty string.</p>
       <li data-md>
        <p><var>itemDetails</var>.purchaseToken SHOULD NOT be the empty string.</p>
      </ol>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with②">a promise resolved with</a> <var>result</var>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="2.2.3" id="consume-method"><span class="secno">2.2.3. </span><span class="content">consume() method</span><a class="self-link" href="#consume-method"></a></h4>
   <p class="note" role="note"><span>Note:</span> Consume in this context means to use up a purchase. The user is expected
to no longer be entitled to the purchase after it is consumed.</p>
   <div class="algorithm" data-algorithm="consume(purchaseToken)" data-algorithm-for="DigitalGoodsService">
     When the <dfn class="dfn-paneled idl-code" data-dfn-for="DigitalGoodsService" data-dfn-type="method" data-export id="dom-digitalgoodsservice-consume"><code>consume(<var>purchaseToken</var>)</code></dfn> method is called, run the following steps: 
    <ol>
     <li data-md>
      <p>If <var>purchaseToken</var> is the empty string, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑧">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror②">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>result</var> be the result of requesting the digital goods service to record <var>purchaseToken</var> as consumed.</p>
    </ol>
    <p class="note" role="note"><span>Note:</span> This allows for different digital goods service providers to be supported by provider-specific behavior in the user agent.</p>
    <ol>
     <li data-md>
      <p>If <var>result</var> is an error, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑨">a promise rejected with</a> an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#operationerror" id="ref-for-operationerror③">OperationError</a></code>.</p>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with③">a promise resolved with</a> <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined①">undefined</a></code>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="2.3" id="itemDetails-dictionary"><span class="secno">2.3. </span><span class="content">ItemDetails dictionary</span><a class="self-link" href="#itemDetails-dictionary"></a></h3>
   <p><em>This section is non-normative.</em></p>
   <div class="note" role="note">
     An <code class="idl"><a data-link-type="idl" href="#dictdef-itemdetails" id="ref-for-dictdef-itemdetails③">ItemDetails</a></code> dictionary represents information about a digital item from
  a <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider" id="ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider②">serviceProvider</a></code>. 
    <ul>
     <li data-md>
      <p><code class="idl"><a data-link-type="idl" href="#dom-itemdetails-itemid" id="ref-for-dom-itemdetails-itemid">itemId</a></code> identifies a particular digital item in the current
app’s inventory. It is expected to be unique within the app but might not be
unique across all apps.</p>
     <li data-md>
      <p><code class="idl"><a data-link-type="idl" href="#dom-itemdetails-title" id="ref-for-dom-itemdetails-title">title</a></code> is the name of the item to display to the user. It is
expected to have been localized for the user by the <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider" id="ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider③">serviceProvider</a></code>.</p>
     <li data-md>
      <p><code class="idl"><a data-link-type="idl" href="#dom-itemdetails-price" id="ref-for-dom-itemdetails-price">price</a></code> is the price of the item and is intended to be able to
be formatted as shown in the <a href="#querying-item-details">§ 1.2 Querying item details</a> example above for
display to the user. It is expected to have been localized for the user by
the <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider" id="ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider④">serviceProvider</a></code>.</p>
     <li data-md>
      <p><code class="idl"><a data-link-type="idl" href="#dom-itemdetails-description" id="ref-for-dom-itemdetails-description">description</a></code> is the full description of the item to display
to the user. It is expected to have been localized for the user by the <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider" id="ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider⑤">serviceProvider</a></code>.</p>
     <li data-md>
      <p><code class="idl"><a data-link-type="idl" href="#dom-itemdetails-subscriptionperiod" id="ref-for-dom-itemdetails-subscriptionperiod">subscriptionPeriod</a></code> is the time period, specified as an <a href="https://en.wikipedia.org/wiki/ISO_8601#Durations">ISO 8601 duration</a>,
in which the item
grants some entitlement to the user. After this period the entitlement is
expected to be renewed or lost (this is not controlled through the Digital
Goods API). This field is only expected to be set for subscriptions and not
for one-off purchases.</p>
     <li data-md>
      <p><code class="idl"><a data-link-type="idl" href="#dom-itemdetails-freetrialperiod" id="ref-for-dom-itemdetails-freetrialperiod">freeTrialPeriod</a></code> is the time period, specified as an <a href="https://en.wikipedia.org/wiki/ISO_8601#Durations">ISO 8601 duration</a>,
in which the item grants
some entitlement to the user without costing anything. After this period the
entitlement is expected to be paid or lost (this is not controlled through
the Digital Goods API). This field is only expected to be set for
subscriptions and not for one-off purchases.</p>
     <li data-md>
      <p><code class="idl"><a data-link-type="idl" href="#dom-itemdetails-introductoryprice" id="ref-for-dom-itemdetails-introductoryprice">introductoryPrice</a></code> is the initial price of the item and is
intended to be able to be formatted as shown in the <a href="#querying-item-details">§ 1.2 Querying item details</a> example above for display to the user. It is
expected to have been localized for the user by the <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider" id="ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider⑥">serviceProvider</a></code>.</p>
     <li data-md>
      <p><code class="idl"><a data-link-type="idl" href="#dom-itemdetails-introductorypriceperiod" id="ref-for-dom-itemdetails-introductorypriceperiod">introductoryPricePeriod</a></code> is the time period, specified as an <a href="https://en.wikipedia.org/wiki/ISO_8601#Durations">ISO 8601 duration</a>,
in which the item costs the <code class="idl"><a data-link-type="idl" href="#dom-itemdetails-introductoryprice" id="ref-for-dom-itemdetails-introductoryprice①">introductoryPrice</a></code>. After this
period the item is epected to cost the <code class="idl"><a data-link-type="idl" href="#dom-itemdetails-price" id="ref-for-dom-itemdetails-price①">price</a></code>.</p>
    </ul>
   </div>
   <h3 class="heading settled" data-level="2.4" id="purchaseDetails-dictionary"><span class="secno">2.4. </span><span class="content">PurchaseDetails dictionary</span><a class="self-link" href="#purchaseDetails-dictionary"></a></h3>
   <p><em>This section is non-normative.</em></p>
   <div class="note" role="note">
     A <code class="idl"><a data-link-type="idl" href="#dictdef-purchasedetails" id="ref-for-dictdef-purchasedetails①">PurchaseDetails</a></code> dictionary represents information about a digital item
  from a <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider" id="ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider⑦">serviceProvider</a></code> to
  which the user is currently entitled. 
    <ul>
     <li data-md>
      <p><code class="idl"><a data-link-type="idl" href="#dom-purchasedetails-itemid" id="ref-for-dom-purchasedetails-itemid">itemId</a></code> identifies a particular digital item in the
current app’s inventory. It is expected to be unique within the app but
might not be unique across all apps. It is expected to be equivalent to an <code class="idl"><a data-link-type="idl" href="#dom-itemdetails-itemid" id="ref-for-dom-itemdetails-itemid①">itemId</a></code> as used in the <code class="idl"><a data-link-type="idl" href="#dom-digitalgoodsservice-getdetails" id="ref-for-dom-digitalgoodsservice-getdetails②">getDetails()</a></code> method.</p>
     <li data-md>
      <p><code class="idl"><a data-link-type="idl" href="#dom-purchasedetails-purchasetoken" id="ref-for-dom-purchasedetails-purchasetoken">purchaseToken</a></code> is an abitrary token representing a
purchase as generated by the <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider" id="ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider⑧">serviceProvider</a></code>. It is
intended to be able to be used to verify the purchase by contacting the
service provider directly (not part of the Digital Goods API).</p>
    </ul>
   </div>
   <h2 class="heading settled" data-level="3" id="permissions-policy-integration"><span class="secno">3. </span><span class="content">Permissions Policy integration</span><a class="self-link" href="#permissions-policy-integration"></a></h2>
   <p>This specification defines a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" id="ref-for-policy-controlled-feature">policy-controlled feature</a> identified
by the string "<a data-link-type="dfn" href="#payment" id="ref-for-payment①">payment</a>". Its <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#default-allowlist" id="ref-for-default-allowlist">default
allowlist</a> is '<code>self</code>'.</p>
   <p class="note" role="note"><span>Note:</span> A <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">document’s</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-document-permissions-policy" id="ref-for-concept-document-permissions-policy">permissions policy</a> determines
whether any content in that document is allowed to get <code class="idl"><a data-link-type="idl" href="#digitalgoodsservice" id="ref-for-digitalgoodsservice③">DigitalGoodsService</a></code> instances. If disabled in any document, no content
in the document will be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use" id="ref-for-allowed-to-use①">allowed to use</a> the <code class="idl"><a data-link-type="idl" href="#dom-window-getdigitalgoodsservice" id="ref-for-dom-window-getdigitalgoodsservice⑥">getDigitalGoodsService()</a></code> method (trying to call the method will throw).</p>
   <h2 class="heading settled" data-level="4" id="additional-definitions"><span class="secno">4. </span><span class="content">Additional Definitions</span><a class="self-link" href="#additional-definitions"></a></h2>
    The "<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="payment">payment</dfn>" permission is a <a data-link-type="biblio" href="#biblio-permissions-policy">[permissions-policy]</a> feature <a href="https://www.w3.org/TR/payment-request/#dfn-payment-permission">defined
  in the payment-request spec</a>. 
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="canonical-paymentcurrencyamount">canonical <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount③">PaymentCurrencyAmount</a></code></dfn> is a <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount④">PaymentCurrencyAmount</a></code> <code>amount</code> that can be run through the steps to <a href="https://www.w3.org/TR/payment-request/#dfn-check-and-canonicalize-amount"> check and canonicalize amount</a> without throwing any errors or being altered.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="iso-8601">iso-8601</dfn> is a standard for date and time representations.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note. </p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#can-make-digital-goods-service-algorithm">can make digital goods service algorithm</a><span>, in § 2.1.2</span>
   <li><a href="#canonical-paymentcurrencyamount">canonical PaymentCurrencyAmount</a><span>, in § 4</span>
   <li><a href="#dom-digitalgoodsservice-consume">consume(purchaseToken)</a><span>, in § 2.2.3</span>
   <li><a href="#dom-itemdetails-description">description</a><span>, in § 2.2</span>
   <li><a href="#digitalgoodsservice">DigitalGoodsService</a><span>, in § 2.2</span>
   <li><a href="#dom-itemdetails-freetrialperiod">freeTrialPeriod</a><span>, in § 2.2</span>
   <li><a href="#dom-digitalgoodsservice-getdetails">getDetails(itemIds)</a><span>, in § 2.2.1</span>
   <li><a href="#dom-window-getdigitalgoodsservice">getDigitalGoodsService(serviceProvider)</a><span>, in § 2.1.1</span>
   <li><a href="#dom-itemdetails-introductoryprice">introductoryPrice</a><span>, in § 2.2</span>
   <li><a href="#dom-itemdetails-introductorypriceperiod">introductoryPricePeriod</a><span>, in § 2.2</span>
   <li><a href="#iso-8601">iso-8601</a><span>, in § 4</span>
   <li><a href="#dictdef-itemdetails">ItemDetails</a><span>, in § 2.2</span>
   <li>
    itemId
    <ul>
     <li><a href="#dom-itemdetails-itemid">dict-member for ItemDetails</a><span>, in § 2.2</span>
     <li><a href="#dom-purchasedetails-itemid">dict-member for PurchaseDetails</a><span>, in § 2.2</span>
    </ul>
   <li><a href="#dom-digitalgoodsservice-listpurchases">listPurchases()</a><span>, in § 2.2.2</span>
   <li><a href="#payment">payment</a><span>, in § 4</span>
   <li><a href="#dom-itemdetails-price">price</a><span>, in § 2.2</span>
   <li><a href="#dictdef-purchasedetails">PurchaseDetails</a><span>, in § 2.2</span>
   <li><a href="#dom-purchasedetails-purchasetoken">purchaseToken</a><span>, in § 2.2</span>
   <li><a href="#dom-itemdetails-subscriptionperiod">subscriptionPeriod</a><span>, in § 2.2</span>
   <li><a href="#dom-itemdetails-title">title</a><span>, in § 2.2</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-concept-document">
   <a href="https://dom.spec.whatwg.org/#concept-document">https://dom.spec.whatwg.org/#concept-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document">3. Permissions Policy integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-window">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#window">https://html.spec.whatwg.org/multipage/window-object.html#window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-window">2.1. Extensions to the Window interface</a> <a href="#ref-for-window①">(2)</a> <a href="#ref-for-window②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-allowed-to-use">
   <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-allowed-to-use">2.1.1. getDigitalGoodsService() method</a>
    <li><a href="#ref-for-allowed-to-use①">3. Permissions Policy integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-current-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-current-settings-object">2.1.1. getDigitalGoodsService() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-fully-active">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#fully-active">https://html.spec.whatwg.org/multipage/browsers.html#fully-active</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fully-active">2.1.1. getDigitalGoodsService() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin">https://html.spec.whatwg.org/multipage/origin.html#concept-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-origin">2.1.1. getDigitalGoodsService() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-permissions-policy">
   <a href="https://html.spec.whatwg.org/multipage/dom.html#concept-document-permissions-policy">https://html.spec.whatwg.org/multipage/dom.html#concept-document-permissions-policy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-permissions-policy">3. Permissions Policy integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-responsible-document">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-document">https://html.spec.whatwg.org/multipage/webappapis.html#responsible-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-responsible-document">2.1.1. getDigitalGoodsService() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-same-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#same-origin">https://html.spec.whatwg.org/multipage/origin.html#same-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-same-origin">2.1.1. getDigitalGoodsService() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-environment-top-level-origin">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin">https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-environment-top-level-origin">2.1.1. getDigitalGoodsService() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-contain">
   <a href="https://infra.spec.whatwg.org/#list-contain">https://infra.spec.whatwg.org/#list-contain</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-contain">2.2.1. getDetails() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-is-empty">
   <a href="https://infra.spec.whatwg.org/#list-is-empty">https://infra.spec.whatwg.org/#list-is-empty</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-is-empty">2.2.1. getDetails() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-user-agent">
   <a href="https://infra.spec.whatwg.org/#user-agent">https://infra.spec.whatwg.org/#user-agent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-user-agent">2.1.2. Can make digital goods service algorithm</a> <a href="#ref-for-user-agent①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-url-based-payment-method-identifier">
   <a href="https://www.w3.org/TR/payment-method-id/#dfn-url-based-payment-method-identifier">https://www.w3.org/TR/payment-method-id/#dfn-url-based-payment-method-identifier</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-url-based-payment-method-identifier">2.1.1. getDigitalGoodsService() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-paymentcurrencyamount">
   <a href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount">https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paymentcurrencyamount">1.2. Querying item details</a>
    <li><a href="#ref-for-dom-paymentcurrencyamount①">2.2. DigitalGoodsService interface</a> <a href="#ref-for-dom-paymentcurrencyamount②">(2)</a>
    <li><a href="#ref-for-dom-paymentcurrencyamount③">4. Additional Definitions</a> <a href="#ref-for-dom-paymentcurrencyamount④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-default-allowlist">
   <a href="https://w3c.github.io/webappsec-permissions-policy/#default-allowlist">https://w3c.github.io/webappsec-permissions-policy/#default-allowlist</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-default-allowlist">3. Permissions Policy integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-policy-controlled-feature">
   <a href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature">https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-controlled-feature">3. Permissions Policy integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMException">
   <a href="https://webidl.spec.whatwg.org/#idl-DOMException">https://webidl.spec.whatwg.org/#idl-DOMException</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMException">2.1.1. getDigitalGoodsService() method</a> <a href="#ref-for-idl-DOMException①">(2)</a> <a href="#ref-for-idl-DOMException②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMString">
   <a href="https://webidl.spec.whatwg.org/#idl-DOMString">https://webidl.spec.whatwg.org/#idl-DOMString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMString">2.1. Extensions to the Window interface</a>
    <li><a href="#ref-for-idl-DOMString①">2.2. DigitalGoodsService interface</a> <a href="#ref-for-idl-DOMString②">(2)</a> <a href="#ref-for-idl-DOMString③">(3)</a> <a href="#ref-for-idl-DOMString④">(4)</a> <a href="#ref-for-idl-DOMString⑤">(5)</a> <a href="#ref-for-idl-DOMString⑥">(6)</a> <a href="#ref-for-idl-DOMString⑦">(7)</a> <a href="#ref-for-idl-DOMString⑧">(8)</a> <a href="#ref-for-idl-DOMString⑨">(9)</a> <a href="#ref-for-idl-DOMString①⓪">(10)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-invalidstateerror">
   <a href="https://webidl.spec.whatwg.org/#invalidstateerror">https://webidl.spec.whatwg.org/#invalidstateerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-invalidstateerror">2.1.1. getDigitalGoodsService() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-notallowederror">
   <a href="https://webidl.spec.whatwg.org/#notallowederror">https://webidl.spec.whatwg.org/#notallowederror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-notallowederror">2.1.1. getDigitalGoodsService() method</a> <a href="#ref-for-notallowederror①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-operationerror">
   <a href="https://webidl.spec.whatwg.org/#operationerror">https://webidl.spec.whatwg.org/#operationerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-operationerror">2.1.1. getDigitalGoodsService() method</a>
    <li><a href="#ref-for-operationerror①">2.2.1. getDetails() method</a>
    <li><a href="#ref-for-operationerror②">2.2.2. listPurchases() method</a>
    <li><a href="#ref-for-operationerror③">2.2.3. consume() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-promise">
   <a href="https://webidl.spec.whatwg.org/#idl-promise">https://webidl.spec.whatwg.org/#idl-promise</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-promise">2.1. Extensions to the Window interface</a>
    <li><a href="#ref-for-idl-promise①">2.2. DigitalGoodsService interface</a> <a href="#ref-for-idl-promise②">(2)</a> <a href="#ref-for-idl-promise③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-SecureContext">
   <a href="https://webidl.spec.whatwg.org/#SecureContext">https://webidl.spec.whatwg.org/#SecureContext</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-SecureContext">2.1. Extensions to the Window interface</a>
    <li><a href="#ref-for-SecureContext①">2.2. DigitalGoodsService interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-exceptiondef-typeerror">
   <a href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror">https://webidl.spec.whatwg.org/#exceptiondef-typeerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exceptiondef-typeerror">2.1.1. getDigitalGoodsService() method</a>
    <li><a href="#ref-for-exceptiondef-typeerror①">2.2.1. getDetails() method</a>
    <li><a href="#ref-for-exceptiondef-typeerror②">2.2.3. consume() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-a-promise-rejected-with">
   <a href="https://webidl.spec.whatwg.org/#a-promise-rejected-with">https://webidl.spec.whatwg.org/#a-promise-rejected-with</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-a-promise-rejected-with">2.1.1. getDigitalGoodsService() method</a> <a href="#ref-for-a-promise-rejected-with①">(2)</a> <a href="#ref-for-a-promise-rejected-with②">(3)</a> <a href="#ref-for-a-promise-rejected-with③">(4)</a> <a href="#ref-for-a-promise-rejected-with④">(5)</a>
    <li><a href="#ref-for-a-promise-rejected-with⑤">2.2.1. getDetails() method</a> <a href="#ref-for-a-promise-rejected-with⑥">(2)</a>
    <li><a href="#ref-for-a-promise-rejected-with⑦">2.2.2. listPurchases() method</a>
    <li><a href="#ref-for-a-promise-rejected-with⑧">2.2.3. consume() method</a> <a href="#ref-for-a-promise-rejected-with⑨">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-a-promise-resolved-with">
   <a href="https://webidl.spec.whatwg.org/#a-promise-resolved-with">https://webidl.spec.whatwg.org/#a-promise-resolved-with</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-a-promise-resolved-with">2.1.1. getDigitalGoodsService() method</a>
    <li><a href="#ref-for-a-promise-resolved-with①">2.2.1. getDetails() method</a>
    <li><a href="#ref-for-a-promise-resolved-with②">2.2.2. listPurchases() method</a>
    <li><a href="#ref-for-a-promise-resolved-with③">2.2.3. consume() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-sequence">
   <a href="https://webidl.spec.whatwg.org/#idl-sequence">https://webidl.spec.whatwg.org/#idl-sequence</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-sequence">2.2. DigitalGoodsService interface</a> <a href="#ref-for-idl-sequence①">(2)</a> <a href="#ref-for-idl-sequence②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-undefined">
   <a href="https://webidl.spec.whatwg.org/#idl-undefined">https://webidl.spec.whatwg.org/#idl-undefined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-undefined">2.2. DigitalGoodsService interface</a>
    <li><a href="#ref-for-idl-undefined①">2.2.3. consume() method</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-document">document</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-window">Window</span>
     <li><span class="dfn-paneled" id="term-for-allowed-to-use">allowed to use</span>
     <li><span class="dfn-paneled" id="term-for-current-settings-object">current settings object</span>
     <li><span class="dfn-paneled" id="term-for-fully-active">fully active</span>
     <li><span class="dfn-paneled" id="term-for-concept-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-permissions-policy">permissions policy</span>
     <li><span class="dfn-paneled" id="term-for-responsible-document">responsible document</span>
     <li><span class="dfn-paneled" id="term-for-same-origin">same origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-environment-top-level-origin">top-level origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-list-contain">contain</span>
     <li><span class="dfn-paneled" id="term-for-list-is-empty">is empty</span>
     <li><span class="dfn-paneled" id="term-for-user-agent">user agent</span>
    </ul>
   <li>
    <a data-link-type="biblio">[payment-method-id]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dfn-url-based-payment-method-identifier">url-based payment method identifier</span>
    </ul>
   <li>
    <a data-link-type="biblio">[payment-request]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-paymentcurrencyamount">PaymentCurrencyAmount</span>
    </ul>
   <li>
    <a data-link-type="biblio">[permissions-policy]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-default-allowlist">default allowlist</span>
     <li><span class="dfn-paneled" id="term-for-policy-controlled-feature">policy-controlled feature</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-DOMException">DOMException</span>
     <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
     <li><span class="dfn-paneled" id="term-for-invalidstateerror">InvalidStateError</span>
     <li><span class="dfn-paneled" id="term-for-notallowederror">NotAllowedError</span>
     <li><span class="dfn-paneled" id="term-for-operationerror">OperationError</span>
     <li><span class="dfn-paneled" id="term-for-idl-promise">Promise</span>
     <li><span class="dfn-paneled" id="term-for-SecureContext">SecureContext</span>
     <li><span class="dfn-paneled" id="term-for-exceptiondef-typeerror">TypeError</span>
     <li><span class="dfn-paneled" id="term-for-a-promise-rejected-with">a promise rejected with</span>
     <li><span class="dfn-paneled" id="term-for-a-promise-resolved-with">a promise resolved with</span>
     <li><span class="dfn-paneled" id="term-for-idl-sequence">sequence</span>
     <li><span class="dfn-paneled" id="term-for-idl-undefined">undefined</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-payment-request">[PAYMENT-REQUEST]
   <dd>Marcos Caceres; Rouslan Solomakhin; Ian Jacobs. <a href="https://w3c.github.io/payment-request/"><cite>Payment Request API</cite></a>. URL: <a href="https://w3c.github.io/payment-request/">https://w3c.github.io/payment-request/</a>
   <dt id="biblio-permissions-policy">[PERMISSIONS-POLICY]
   <dd>Ian Clelland. <a href="https://w3c.github.io/webappsec-permissions-policy/"><cite>Permissions Policy</cite></a>. URL: <a href="https://w3c.github.io/webappsec-permissions-policy/">https://w3c.github.io/webappsec-permissions-policy/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-payment-method-id">[PAYMENT-METHOD-ID]
   <dd>Marcos Caceres. <a href="https://w3c.github.io/payment-method-id/"><cite>Payment Method Identifiers</cite></a>. URL: <a href="https://w3c.github.io/payment-method-id/">https://w3c.github.io/payment-method-id/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window"><c- g>Window</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#digitalgoodsservice"><c- n>DigitalGoodsService</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-window-getdigitalgoodsservice"><c- g>getDigitalGoodsService</c-></a>(
      <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider"><code><c- g>serviceProvider</c-></code></a>);
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>] <c- b>interface</c-> <a href="#digitalgoodsservice"><code><c- g>DigitalGoodsService</c-></code></a> {

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-itemdetails"><c- n>ItemDetails</c-></a>>> <a class="idl-code" data-link-type="method" href="#dom-digitalgoodsservice-getdetails"><c- g>getDetails</c-></a>(<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>> <a href="#dom-digitalgoodsservice-getdetails-itemids-itemids"><code><c- g>itemIds</c-></code></a>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-purchasedetails"><c- n>PurchaseDetails</c-></a>>> <a class="idl-code" data-link-type="method" href="#dom-digitalgoodsservice-listpurchases"><c- g>listPurchases</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-digitalgoodsservice-consume"><c- g>consume</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-digitalgoodsservice-consume-purchasetoken-purchasetoken"><code><c- g>purchaseToken</c-></code></a>);
};

<c- b>dictionary</c-> <a href="#dictdef-itemdetails"><code><c- g>ItemDetails</c-></code></a> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-itemdetails-itemid"><code><c- g>itemId</c-></code></a>;
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-itemdetails-title"><code><c- g>title</c-></code></a>;
  <c- b>required</c-> <a data-link-type="idl-name" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount"><c- n>PaymentCurrencyAmount</c-></a> <a data-type="PaymentCurrencyAmount " href="#dom-itemdetails-price"><code><c- g>price</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-itemdetails-description"><code><c- g>description</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-itemdetails-subscriptionperiod"><code><c- g>subscriptionPeriod</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-itemdetails-freetrialperiod"><code><c- g>freeTrialPeriod</c-></code></a>;
  <a data-link-type="idl-name" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount"><c- n>PaymentCurrencyAmount</c-></a> <a data-type="PaymentCurrencyAmount " href="#dom-itemdetails-introductoryprice"><code><c- g>introductoryPrice</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-itemdetails-introductorypriceperiod"><code><c- g>introductoryPricePeriod</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-purchasedetails"><code><c- g>PurchaseDetails</c-></code></a> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-purchasedetails-itemid"><code><c- g>itemId</c-></code></a>;
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-purchasedetails-purchasetoken"><code><c- g>purchaseToken</c-></code></a>;
};

</pre>
  <aside class="dfn-panel" data-for="dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider">
   <b><a href="#dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider">#dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider">2.1.1. getDigitalGoodsService() method</a> <a href="#ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider①">(2)</a>
    <li><a href="#ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider②">2.3. ItemDetails dictionary</a> <a href="#ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider③">(2)</a> <a href="#ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider④">(3)</a> <a href="#ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider⑤">(4)</a> <a href="#ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider⑥">(5)</a>
    <li><a href="#ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider⑦">2.4. PurchaseDetails dictionary</a> <a href="#ref-for-dom-window-getdigitalgoodsservice-serviceprovider-serviceprovider⑧">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-window-getdigitalgoodsservice">
   <b><a href="#dom-window-getdigitalgoodsservice">#dom-window-getdigitalgoodsservice</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-window-getdigitalgoodsservice">1.1. Getting a service instance</a>
    <li><a href="#ref-for-dom-window-getdigitalgoodsservice①">2.1. Extensions to the Window interface</a> <a href="#ref-for-dom-window-getdigitalgoodsservice②">(2)</a> <a href="#ref-for-dom-window-getdigitalgoodsservice③">(3)</a> <a href="#ref-for-dom-window-getdigitalgoodsservice④">(4)</a>
    <li><a href="#ref-for-dom-window-getdigitalgoodsservice⑤">2.1.1. getDigitalGoodsService() method</a>
    <li><a href="#ref-for-dom-window-getdigitalgoodsservice⑥">3. Permissions Policy integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="can-make-digital-goods-service-algorithm">
   <b><a href="#can-make-digital-goods-service-algorithm">#can-make-digital-goods-service-algorithm</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-can-make-digital-goods-service-algorithm">2.1.1. getDigitalGoodsService() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="digitalgoodsservice">
   <b><a href="#digitalgoodsservice">#digitalgoodsservice</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-digitalgoodsservice">2.1. Extensions to the Window interface</a>
    <li><a href="#ref-for-digitalgoodsservice①">2.1.1. getDigitalGoodsService() method</a> <a href="#ref-for-digitalgoodsservice②">(2)</a>
    <li><a href="#ref-for-digitalgoodsservice③">3. Permissions Policy integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-itemdetails">
   <b><a href="#dictdef-itemdetails">#dictdef-itemdetails</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-itemdetails">1.2. Querying item details</a> <a href="#ref-for-dictdef-itemdetails①">(2)</a>
    <li><a href="#ref-for-dictdef-itemdetails②">2.2. DigitalGoodsService interface</a>
    <li><a href="#ref-for-dictdef-itemdetails③">2.3. ItemDetails dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-itemdetails-itemid">
   <b><a href="#dom-itemdetails-itemid">#dom-itemdetails-itemid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-itemdetails-itemid">2.3. ItemDetails dictionary</a>
    <li><a href="#ref-for-dom-itemdetails-itemid①">2.4. PurchaseDetails dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-itemdetails-title">
   <b><a href="#dom-itemdetails-title">#dom-itemdetails-title</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-itemdetails-title">2.3. ItemDetails dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-itemdetails-price">
   <b><a href="#dom-itemdetails-price">#dom-itemdetails-price</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-itemdetails-price">2.3. ItemDetails dictionary</a> <a href="#ref-for-dom-itemdetails-price①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-itemdetails-description">
   <b><a href="#dom-itemdetails-description">#dom-itemdetails-description</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-itemdetails-description">2.3. ItemDetails dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-itemdetails-subscriptionperiod">
   <b><a href="#dom-itemdetails-subscriptionperiod">#dom-itemdetails-subscriptionperiod</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-itemdetails-subscriptionperiod">2.3. ItemDetails dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-itemdetails-freetrialperiod">
   <b><a href="#dom-itemdetails-freetrialperiod">#dom-itemdetails-freetrialperiod</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-itemdetails-freetrialperiod">2.3. ItemDetails dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-itemdetails-introductoryprice">
   <b><a href="#dom-itemdetails-introductoryprice">#dom-itemdetails-introductoryprice</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-itemdetails-introductoryprice">2.3. ItemDetails dictionary</a> <a href="#ref-for-dom-itemdetails-introductoryprice①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-itemdetails-introductorypriceperiod">
   <b><a href="#dom-itemdetails-introductorypriceperiod">#dom-itemdetails-introductorypriceperiod</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-itemdetails-introductorypriceperiod">2.3. ItemDetails dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-purchasedetails">
   <b><a href="#dictdef-purchasedetails">#dictdef-purchasedetails</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-purchasedetails">2.2. DigitalGoodsService interface</a>
    <li><a href="#ref-for-dictdef-purchasedetails①">2.4. PurchaseDetails dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-purchasedetails-itemid">
   <b><a href="#dom-purchasedetails-itemid">#dom-purchasedetails-itemid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-purchasedetails-itemid">2.4. PurchaseDetails dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-purchasedetails-purchasetoken">
   <b><a href="#dom-purchasedetails-purchasetoken">#dom-purchasedetails-purchasetoken</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-purchasedetails-purchasetoken">2.4. PurchaseDetails dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-digitalgoodsservice-getdetails">
   <b><a href="#dom-digitalgoodsservice-getdetails">#dom-digitalgoodsservice-getdetails</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-digitalgoodsservice-getdetails">1.2. Querying item details</a>
    <li><a href="#ref-for-dom-digitalgoodsservice-getdetails①">2.2. DigitalGoodsService interface</a>
    <li><a href="#ref-for-dom-digitalgoodsservice-getdetails②">2.4. PurchaseDetails dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-digitalgoodsservice-listpurchases">
   <b><a href="#dom-digitalgoodsservice-listpurchases">#dom-digitalgoodsservice-listpurchases</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-digitalgoodsservice-listpurchases">1.4. Checking existing purchases</a>
    <li><a href="#ref-for-dom-digitalgoodsservice-listpurchases①">2.2. DigitalGoodsService interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-digitalgoodsservice-consume">
   <b><a href="#dom-digitalgoodsservice-consume">#dom-digitalgoodsservice-consume</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-digitalgoodsservice-consume">1.5. Consuming a purchase</a>
    <li><a href="#ref-for-dom-digitalgoodsservice-consume①">2.2. DigitalGoodsService interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="payment">
   <b><a href="#payment">#payment</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-payment">2.1.1. getDigitalGoodsService() method</a>
    <li><a href="#ref-for-payment①">3. Permissions Policy integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="canonical-paymentcurrencyamount">
   <b><a href="#canonical-paymentcurrencyamount">#canonical-paymentcurrencyamount</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-canonical-paymentcurrencyamount">2.2.1. getDetails() method</a> <a href="#ref-for-canonical-paymentcurrencyamount①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="iso-8601">
   <b><a href="#iso-8601">#iso-8601</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-iso-8601">2.2.1. getDetails() method</a> <a href="#ref-for-iso-8601①">(2)</a> <a href="#ref-for-iso-8601②">(3)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>